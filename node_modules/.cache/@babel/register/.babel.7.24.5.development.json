{"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\min\\\\Desktop\\\\webRTC-lab\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"C:\\\\Users\\\\min\\\\Desktop\\\\webRTC-lab\",\"filename\":\"C:\\\\Users\\\\min\\\\Desktop\\\\webRTC-lab\\\\src\\\\server.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\min\\\\Desktop\\\\webRTC-lab\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"transform-unicode-sets-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-class-static-block\",\"visitor\":{\"ClassBody\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-private-property-in-object\",\"visitor\":{\"BinaryExpression\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-private-methods\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-numeric-separator\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"BigIntLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-logical-assignment-operators\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-nullish-coalescing-operator\",\"visitor\":{\"LogicalExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-chaining\",\"visitor\":{\"OptionalCallExpression\":{\"enter\":[null]},\"OptionalMemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-json-strings\",\"visitor\":{\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-catch-binding\",\"visitor\":{\"CatchClause\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-parameters\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-generator-functions\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-to-generator\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-exponentiation-operator\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-template-literals\",\"visitor\":{\"TaggedTemplateExpression\":{\"enter\":[null]},\"TemplateLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-literals\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-function-name\",\"visitor\":{\"FunctionExpression\":{\"exit\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-arrow-functions\",\"visitor\":{\"ArrowFunctionExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoped-functions\",\"visitor\":{\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-classes\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-super\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"DoWhileStatement\":{\"exit\":[null]},\"ForInStatement\":{\"exit\":[null]},\"ForStatement\":{\"exit\":[null]},\"WhileStatement\":{\"exit\":[null]},\"ForOfStatement\":{\"exit\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-shorthand-properties\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-duplicate-keys\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-computed-properties\",\"visitor\":{\"ObjectExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-for-of\",\"visitor\":{\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-sticky-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-escapes\",\"visitor\":{\"Identifier\":{\"enter\":[null]},\"TemplateElement\":{\"enter\":[null]},\"_exploded\":true,\"StringLiteral\":{\"enter\":[null]},\"DirectiveLiteral\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-spread\",\"visitor\":{\"ArrayExpression\":{\"enter\":[null]},\"CallExpression\":{\"enter\":[null]},\"NewExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-destructuring\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"VariableDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoping\",\"visitor\":{\"VariableDeclaration\":{\"enter\":[null,null]},\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-typeof-symbol\",\"visitor\":{\"UnaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"BlockStatement\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"Program\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"SwitchStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"StaticBlock\":{\"enter\":[null]},\"TSModuleBlock\":{\"enter\":[null]},\"AssignmentPattern\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-new-target\",\"visitor\":{\"MetaProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-regenerator\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassPrivateMethod\":{\"enter\":[null],\"exit\":[null]},\"FunctionDeclaration\":{\"exit\":[null]},\"FunctionExpression\":{\"exit\":[null]},\"ArrowFunctionExpression\":{\"exit\":[null]},\"CallExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-member-expression-literals\",\"visitor\":{\"MemberExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-property-literals\",\"visitor\":{\"ObjectProperty\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-reserved-words\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null,null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-export-namespace-from\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"Program\":{\"exit\":[null]},\"_exploded\":true,\"CallExpression\":{\"enter\":[null]},\"ImportExpression\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dynamic-import\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-top-level-await\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-import-meta\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.24.5:development":{"value":{"code":"\"use strict\";\n\nvar _express = _interopRequireDefault(require(\"express\"));\nvar _socket = require(\"socket.io\");\nvar _http = _interopRequireDefault(require(\"http\"));\nvar _adminUi = require(\"@socket.io/admin-ui\");\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n// import WebSocket from 'ws';\n\nvar app = (0, _express[\"default\"])();\napp.set('view engine', 'pug');\napp.set(\"views\", __dirname + \"/views\");\napp.use(\"/public\", _express[\"default\"][\"static\"](__dirname + \"/public\"));\napp.get(\"/\", function (_, res) {\n  return res.render(\"home\");\n});\napp.get(\"/*\", function (_, res) {\n  return res.redirect(\"/\");\n});\nvar handleListen = function handleListen() {\n  return console.log(\"Listening on: http://localhost:3000\");\n};\nvar httpServer = _http[\"default\"].createServer(app);\n// const wss = new WebSocket.Server({ server });\nvar wsServer = new _socket.Server(httpServer, {\n  cors: {\n    origin: [\"https://localhost:3000/admin/socket.io\"],\n    credentials: true\n  }\n});\n(0, _adminUi.instrument)(wsServer, {\n  auth: false\n});\nfunction publicRooms() {\n  var _wsServer$sockets$ada = wsServer.sockets.adapter,\n    sids = _wsServer$sockets$ada.sids,\n    rooms = _wsServer$sockets$ada.rooms;\n  var publicRooms = [];\n  rooms.forEach(function (_, key) {\n    if (sids.get(key) === undefined) {\n      publicRooms.push(key);\n    }\n  });\n  return publicRooms;\n}\n// const sids = wsServer.sockets.adapter.sids;\n// const rooms = wsServer.sockets.adapter.rooms;\n\nfunction countRoom(roomName) {\n  var _wsServer$sockets$ada2;\n  return (_wsServer$sockets$ada2 = wsServer.sockets.adapter.rooms.get(roomName)) === null || _wsServer$sockets$ada2 === void 0 ? void 0 : _wsServer$sockets$ada2.size;\n}\nwsServer.on(\"connection\", function (socket) {\n  socket[\"nickname\"] = \"Anonymous\";\n  socket.onAny(function (event) {\n    console.log(wsServer.sockets.adapter.rooms);\n    console.log(\"Socket Event: \".concat(event));\n  });\n\n  // console.log(socket);\n  socket.on(\"enter_room\", function (roomName, done) {\n    // console.log(socket.id);\n    // console.log(socket.rooms); // set { <socket.id> }\n    socket.join(roomName);\n    // console.log(socket.rooms); // set { <socket.id>, roomName }\n    done();\n    socket.to(roomName).emit(\"welcome\", socket.nickname, countRoom(roomName)); // roomName에 있는 모든 socket(사람)들에게 welcome event를 보낸다\n    wsServer.sockets.emit(\"room_change\", publicRooms());\n  });\n  socket.on(\"disconnecting\", function () {\n    socket.rooms.forEach(function (room) {\n      return socket.to(room).emit(\"bye\", socket.nickname, countRoom(room) - 1);\n    });\n  });\n  socket.on(\"disconnect\", function () {\n    wsServer.sockets.emit(\"room_change\", publicRooms());\n  });\n  socket.on(\"new_message\", function (msg, room, done) {\n    socket.to(room).emit(\"new_message\", \"\".concat(socket.nickname, \": \").concat(msg));\n    done();\n  });\n  socket.on(\"nickname\", function (nickname) {\n    return socket[\"nickname\"] = nickname;\n  });\n});\nfunction onSocketClose() {\n  console.log(\"Disconnected from the Browser ❌\");\n}\nfunction onSocketMessage(message) {\n  console.log(message.toString('utf8'));\n}\n\n// const sockets_arr = [];\n\n// wss.on(\"connection\", (socket) => {\n//     sockets_arr.push(socket);\n//     socket[\"nickname\"] = \"Anonymous\";\n//     console.log(\"Connected to Browser ✅\");\n//     socket.on(\"close\", onSocketClose);\n//     socket.on(\"message\", (msg) => {\n//         const message = JSON.parse(msg); //Json.parse는 string을 object로 바꿔준다\n//         switch (message.type) {\n//             case \"new_message\":\n//                 sockets_arr.forEach((aSocket) => aSocket.send(`${socket.nickname}: ${message.payload}`));\n//                 break;\n//             case \"nickname\":\n//                 socket[\"nickname\"] = message.payload;\n//             // console.log(message.payload);\n//         }\n//         // if (parsed.type === \"new_message\") {\n//         //     sockets_arr.forEach((aSocket) => aSocket.send(parsed.payload));\n//         // } else if(parsed.type === \"nickname\") {\n//         //     console.log(parsed.payload);\n//         // }\n//         // sockets_arr.forEach((aSocket) => aSocket.send(message.toString('utf8')));\n//     });\n// });\n\nhttpServer.listen(3000, handleListen);\n\n// {\n//     type: \"message\",\n//     payload: \"hello everyone!\"\n// }\n\n// {\n//     type: \"nickname\",\n//     payload: \"min\"\n// }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3NvY2tldCIsIl9odHRwIiwiX2FkbWluVWkiLCJvYmoiLCJfX2VzTW9kdWxlIiwiYXBwIiwiZXhwcmVzcyIsInNldCIsIl9fZGlybmFtZSIsInVzZSIsImdldCIsIl8iLCJyZXMiLCJyZW5kZXIiLCJyZWRpcmVjdCIsImhhbmRsZUxpc3RlbiIsImNvbnNvbGUiLCJsb2ciLCJodHRwU2VydmVyIiwiaHR0cCIsImNyZWF0ZVNlcnZlciIsIndzU2VydmVyIiwiU2VydmVyIiwiY29ycyIsIm9yaWdpbiIsImNyZWRlbnRpYWxzIiwiaW5zdHJ1bWVudCIsImF1dGgiLCJwdWJsaWNSb29tcyIsIl93c1NlcnZlciRzb2NrZXRzJGFkYSIsInNvY2tldHMiLCJhZGFwdGVyIiwic2lkcyIsInJvb21zIiwiZm9yRWFjaCIsImtleSIsInVuZGVmaW5lZCIsInB1c2giLCJjb3VudFJvb20iLCJyb29tTmFtZSIsIl93c1NlcnZlciRzb2NrZXRzJGFkYTIiLCJzaXplIiwib24iLCJzb2NrZXQiLCJvbkFueSIsImV2ZW50IiwiY29uY2F0IiwiZG9uZSIsImpvaW4iLCJ0byIsImVtaXQiLCJuaWNrbmFtZSIsInJvb20iLCJtc2ciLCJvblNvY2tldENsb3NlIiwib25Tb2NrZXRNZXNzYWdlIiwibWVzc2FnZSIsInRvU3RyaW5nIiwibGlzdGVuIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXG1pblxcRGVza3RvcFxcd2ViUlRDLWxhYlxcc3JjXFwiLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IHsgU2VydmVyIH0gZnJvbSAnc29ja2V0LmlvJztcclxuaW1wb3J0IGh0dHAgZnJvbSAnaHR0cCc7XHJcbmltcG9ydCB7IGluc3RydW1lbnQgfSBmcm9tICdAc29ja2V0LmlvL2FkbWluLXVpJztcclxuLy8gaW1wb3J0IFdlYlNvY2tldCBmcm9tICd3cyc7XHJcblxyXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XHJcblxyXG5hcHAuc2V0KCd2aWV3IGVuZ2luZScsICdwdWcnKTtcclxuYXBwLnNldChcInZpZXdzXCIsIF9fZGlybmFtZSArIFwiL3ZpZXdzXCIpO1xyXG5hcHAudXNlKFwiL3B1YmxpY1wiLCBleHByZXNzLnN0YXRpYyhfX2Rpcm5hbWUgKyBcIi9wdWJsaWNcIikpO1xyXG5cclxuYXBwLmdldChcIi9cIiwgKF8sIHJlcykgPT4gcmVzLnJlbmRlcihcImhvbWVcIikpO1xyXG5hcHAuZ2V0KFwiLypcIiwgKF8sIHJlcykgPT4gcmVzLnJlZGlyZWN0KFwiL1wiKSk7XHJcblxyXG5jb25zdCBoYW5kbGVMaXN0ZW4gPSAoKSA9PiBjb25zb2xlLmxvZyhgTGlzdGVuaW5nIG9uOiBodHRwOi8vbG9jYWxob3N0OjMwMDBgKTtcclxuXHJcbmNvbnN0IGh0dHBTZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcihhcHApO1xyXG4vLyBjb25zdCB3c3MgPSBuZXcgV2ViU29ja2V0LlNlcnZlcih7IHNlcnZlciB9KTtcclxuY29uc3Qgd3NTZXJ2ZXIgPSBuZXcgU2VydmVyKGh0dHBTZXJ2ZXIsIHtcclxuICAgIGNvcnM6IHtcclxuICAgICAgICBvcmlnaW46IFtcImh0dHBzOi8vbG9jYWxob3N0OjMwMDAvYWRtaW4vc29ja2V0LmlvXCJdLFxyXG4gICAgICAgIGNyZWRlbnRpYWxzOiB0cnVlLFxyXG4gICAgfSxcclxufSk7XHJcbmluc3RydW1lbnQod3NTZXJ2ZXIsIHtcclxuICAgIGF1dGg6IGZhbHNlXHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gcHVibGljUm9vbXMoKSB7XHJcbiAgICBjb25zdCB7IHNvY2tldHM6IHsgYWRhcHRlcjogeyBzaWRzLCByb29tcyB9IH0gfSA9IHdzU2VydmVyO1xyXG4gICAgY29uc3QgcHVibGljUm9vbXMgPSBbXTtcclxuICAgIHJvb21zLmZvckVhY2goKF8sIGtleSkgPT4ge1xyXG4gICAgICAgIGlmIChzaWRzLmdldChrZXkpID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcHVibGljUm9vbXMucHVzaChrZXkpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHB1YmxpY1Jvb21zO1xyXG59XHJcbi8vIGNvbnN0IHNpZHMgPSB3c1NlcnZlci5zb2NrZXRzLmFkYXB0ZXIuc2lkcztcclxuLy8gY29uc3Qgcm9vbXMgPSB3c1NlcnZlci5zb2NrZXRzLmFkYXB0ZXIucm9vbXM7XHJcblxyXG5mdW5jdGlvbiBjb3VudFJvb20ocm9vbU5hbWUpIHtcclxuICAgIHJldHVybiB3c1NlcnZlci5zb2NrZXRzLmFkYXB0ZXIucm9vbXMuZ2V0KHJvb21OYW1lKT8uc2l6ZTtcclxufVxyXG53c1NlcnZlci5vbihcImNvbm5lY3Rpb25cIiwgKHNvY2tldCkgPT4ge1xyXG4gICAgc29ja2V0W1wibmlja25hbWVcIl0gPSBcIkFub255bW91c1wiO1xyXG4gICAgc29ja2V0Lm9uQW55KChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHdzU2VydmVyLnNvY2tldHMuYWRhcHRlci5yb29tcyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFNvY2tldCBFdmVudDogJHtldmVudH1gKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGNvbnNvbGUubG9nKHNvY2tldCk7XHJcbiAgICBzb2NrZXQub24oXCJlbnRlcl9yb29tXCIsIChyb29tTmFtZSwgZG9uZSkgPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHNvY2tldC5pZCk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coc29ja2V0LnJvb21zKTsgLy8gc2V0IHsgPHNvY2tldC5pZD4gfVxyXG4gICAgICAgIHNvY2tldC5qb2luKHJvb21OYW1lKTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhzb2NrZXQucm9vbXMpOyAvLyBzZXQgeyA8c29ja2V0LmlkPiwgcm9vbU5hbWUgfVxyXG4gICAgICAgIGRvbmUoKTtcclxuICAgICAgICBzb2NrZXQudG8ocm9vbU5hbWUpLmVtaXQoXCJ3ZWxjb21lXCIsIHNvY2tldC5uaWNrbmFtZSwgY291bnRSb29tKHJvb21OYW1lKSk7IC8vIHJvb21OYW1l7JeQIOyeiOuKlCDrqqjrk6Agc29ja2V0KOyCrOuejCnrk6Tsl5Dqsowgd2VsY29tZSBldmVudOulvCDrs7Trgrjri6RcclxuICAgICAgICB3c1NlcnZlci5zb2NrZXRzLmVtaXQoXCJyb29tX2NoYW5nZVwiLCBwdWJsaWNSb29tcygpKTtcclxuICAgIH0pO1xyXG4gICAgc29ja2V0Lm9uKFwiZGlzY29ubmVjdGluZ1wiLCAoKSA9PiB7XHJcbiAgICAgICAgc29ja2V0LnJvb21zLmZvckVhY2goKHJvb20pID0+IHNvY2tldC50byhyb29tKS5lbWl0KFwiYnllXCIsIHNvY2tldC5uaWNrbmFtZSwgY291bnRSb29tKHJvb20pIC0gMSkpO1xyXG5cclxuICAgIH0pO1xyXG4gICAgc29ja2V0Lm9uKFwiZGlzY29ubmVjdFwiLCAoKSA9PiB7XHJcbiAgICAgICAgd3NTZXJ2ZXIuc29ja2V0cy5lbWl0KFwicm9vbV9jaGFuZ2VcIiwgcHVibGljUm9vbXMoKSk7XHJcbiAgICB9KTtcclxuICAgIHNvY2tldC5vbihcIm5ld19tZXNzYWdlXCIsIChtc2csIHJvb20sIGRvbmUpID0+IHtcclxuICAgICAgICBzb2NrZXQudG8ocm9vbSkuZW1pdChcIm5ld19tZXNzYWdlXCIsIGAke3NvY2tldC5uaWNrbmFtZX06ICR7bXNnfWApO1xyXG4gICAgICAgIGRvbmUoKTtcclxuICAgIH0pO1xyXG4gICAgc29ja2V0Lm9uKFwibmlja25hbWVcIiwgKG5pY2tuYW1lKSA9PiAoc29ja2V0W1wibmlja25hbWVcIl0gPSBuaWNrbmFtZSkpO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIG9uU29ja2V0Q2xvc2UoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkRpc2Nvbm5lY3RlZCBmcm9tIHRoZSBCcm93c2VyIOKdjFwiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gb25Tb2NrZXRNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UudG9TdHJpbmcoJ3V0ZjgnKSk7XHJcbn1cclxuXHJcbi8vIGNvbnN0IHNvY2tldHNfYXJyID0gW107XHJcblxyXG4vLyB3c3Mub24oXCJjb25uZWN0aW9uXCIsIChzb2NrZXQpID0+IHtcclxuLy8gICAgIHNvY2tldHNfYXJyLnB1c2goc29ja2V0KTtcclxuLy8gICAgIHNvY2tldFtcIm5pY2tuYW1lXCJdID0gXCJBbm9ueW1vdXNcIjtcclxuLy8gICAgIGNvbnNvbGUubG9nKFwiQ29ubmVjdGVkIHRvIEJyb3dzZXIg4pyFXCIpO1xyXG4vLyAgICAgc29ja2V0Lm9uKFwiY2xvc2VcIiwgb25Tb2NrZXRDbG9zZSk7XHJcbi8vICAgICBzb2NrZXQub24oXCJtZXNzYWdlXCIsIChtc2cpID0+IHtcclxuLy8gICAgICAgICBjb25zdCBtZXNzYWdlID0gSlNPTi5wYXJzZShtc2cpOyAvL0pzb24ucGFyc2XripQgc3RyaW5n7J2EIG9iamVjdOuhnCDrsJTqv5TspIDri6RcclxuLy8gICAgICAgICBzd2l0Y2ggKG1lc3NhZ2UudHlwZSkge1xyXG4vLyAgICAgICAgICAgICBjYXNlIFwibmV3X21lc3NhZ2VcIjpcclxuLy8gICAgICAgICAgICAgICAgIHNvY2tldHNfYXJyLmZvckVhY2goKGFTb2NrZXQpID0+IGFTb2NrZXQuc2VuZChgJHtzb2NrZXQubmlja25hbWV9OiAke21lc3NhZ2UucGF5bG9hZH1gKSk7XHJcbi8vICAgICAgICAgICAgICAgICBicmVhaztcclxuLy8gICAgICAgICAgICAgY2FzZSBcIm5pY2tuYW1lXCI6XHJcbi8vICAgICAgICAgICAgICAgICBzb2NrZXRbXCJuaWNrbmFtZVwiXSA9IG1lc3NhZ2UucGF5bG9hZDtcclxuLy8gICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobWVzc2FnZS5wYXlsb2FkKTtcclxuLy8gICAgICAgICB9XHJcbi8vICAgICAgICAgLy8gaWYgKHBhcnNlZC50eXBlID09PSBcIm5ld19tZXNzYWdlXCIpIHtcclxuLy8gICAgICAgICAvLyAgICAgc29ja2V0c19hcnIuZm9yRWFjaCgoYVNvY2tldCkgPT4gYVNvY2tldC5zZW5kKHBhcnNlZC5wYXlsb2FkKSk7XHJcbi8vICAgICAgICAgLy8gfSBlbHNlIGlmKHBhcnNlZC50eXBlID09PSBcIm5pY2tuYW1lXCIpIHtcclxuLy8gICAgICAgICAvLyAgICAgY29uc29sZS5sb2cocGFyc2VkLnBheWxvYWQpO1xyXG4vLyAgICAgICAgIC8vIH1cclxuLy8gICAgICAgICAvLyBzb2NrZXRzX2Fyci5mb3JFYWNoKChhU29ja2V0KSA9PiBhU29ja2V0LnNlbmQobWVzc2FnZS50b1N0cmluZygndXRmOCcpKSk7XHJcbi8vICAgICB9KTtcclxuLy8gfSk7XHJcblxyXG5odHRwU2VydmVyLmxpc3RlbigzMDAwLCBoYW5kbGVMaXN0ZW4pO1xyXG5cclxuLy8ge1xyXG4vLyAgICAgdHlwZTogXCJtZXNzYWdlXCIsXHJcbi8vICAgICBwYXlsb2FkOiBcImhlbGxvIGV2ZXJ5b25lIVwiXHJcbi8vIH1cclxuXHJcbi8vIHtcclxuLy8gICAgIHR5cGU6IFwibmlja25hbWVcIixcclxuLy8gICAgIHBheWxvYWQ6IFwibWluXCJcclxuLy8gfSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxRQUFBLEdBQUFILE9BQUE7QUFBaUQsU0FBQUQsdUJBQUFLLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxnQkFBQUEsR0FBQTtBQUNqRDs7QUFFQSxJQUFNRSxHQUFHLEdBQUcsSUFBQUMsbUJBQU8sRUFBQyxDQUFDO0FBRXJCRCxHQUFHLENBQUNFLEdBQUcsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFD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","map":{"version":3,"names":["_express","_interopRequireDefault","require","_socket","_http","_adminUi","obj","__esModule","app","express","set","__dirname","use","get","_","res","render","redirect","handleListen","console","log","httpServer","http","createServer","wsServer","Server","cors","origin","credentials","instrument","auth","publicRooms","_wsServer$sockets$ada","sockets","adapter","sids","rooms","forEach","key","undefined","push","countRoom","roomName","_wsServer$sockets$ada2","size","on","socket","onAny","event","concat","done","join","to","emit","nickname","room","msg","onSocketClose","onSocketMessage","message","toString","listen"],"sourceRoot":"C:\\Users\\min\\Desktop\\webRTC-lab\\src\\","sources":["server.js"],"sourcesContent":["import express from 'express';\r\nimport { Server } from 'socket.io';\r\nimport http from 'http';\r\nimport { instrument } from '@socket.io/admin-ui';\r\n// import WebSocket from 'ws';\r\n\r\nconst app = express();\r\n\r\napp.set('view engine', 'pug');\r\napp.set(\"views\", __dirname + \"/views\");\r\napp.use(\"/public\", express.static(__dirname + \"/public\"));\r\n\r\napp.get(\"/\", (_, res) => res.render(\"home\"));\r\napp.get(\"/*\", (_, res) => res.redirect(\"/\"));\r\n\r\nconst handleListen = () => console.log(`Listening on: http://localhost:3000`);\r\n\r\nconst httpServer = http.createServer(app);\r\n// const wss = new WebSocket.Server({ server });\r\nconst wsServer = new Server(httpServer, {\r\n    cors: {\r\n        origin: [\"https://localhost:3000/admin/socket.io\"],\r\n        credentials: true,\r\n    },\r\n});\r\ninstrument(wsServer, {\r\n    auth: false\r\n});\r\n\r\nfunction publicRooms() {\r\n    const { sockets: { adapter: { sids, rooms } } } = wsServer;\r\n    const publicRooms = [];\r\n    rooms.forEach((_, key) => {\r\n        if (sids.get(key) === undefined) {\r\n            publicRooms.push(key);\r\n        }\r\n    });\r\n    return publicRooms;\r\n}\r\n// const sids = wsServer.sockets.adapter.sids;\r\n// const rooms = wsServer.sockets.adapter.rooms;\r\n\r\nfunction countRoom(roomName) {\r\n    return wsServer.sockets.adapter.rooms.get(roomName)?.size;\r\n}\r\nwsServer.on(\"connection\", (socket) => {\r\n    socket[\"nickname\"] = \"Anonymous\";\r\n    socket.onAny((event) => {\r\n        console.log(wsServer.sockets.adapter.rooms);\r\n        console.log(`Socket Event: ${event}`);\r\n    });\r\n\r\n    // console.log(socket);\r\n    socket.on(\"enter_room\", (roomName, done) => {\r\n        // console.log(socket.id);\r\n        // console.log(socket.rooms); // set { <socket.id> }\r\n        socket.join(roomName);\r\n        // console.log(socket.rooms); // set { <socket.id>, roomName }\r\n        done();\r\n        socket.to(roomName).emit(\"welcome\", socket.nickname, countRoom(roomName)); // roomName에 있는 모든 socket(사람)들에게 welcome event를 보낸다\r\n        wsServer.sockets.emit(\"room_change\", publicRooms());\r\n    });\r\n    socket.on(\"disconnecting\", () => {\r\n        socket.rooms.forEach((room) => socket.to(room).emit(\"bye\", socket.nickname, countRoom(room) - 1));\r\n\r\n    });\r\n    socket.on(\"disconnect\", () => {\r\n        wsServer.sockets.emit(\"room_change\", publicRooms());\r\n    });\r\n    socket.on(\"new_message\", (msg, room, done) => {\r\n        socket.to(room).emit(\"new_message\", `${socket.nickname}: ${msg}`);\r\n        done();\r\n    });\r\n    socket.on(\"nickname\", (nickname) => (socket[\"nickname\"] = nickname));\r\n});\r\n\r\nfunction onSocketClose() {\r\n    console.log(\"Disconnected from the Browser ❌\");\r\n}\r\n\r\nfunction onSocketMessage(message) {\r\n    console.log(message.toString('utf8'));\r\n}\r\n\r\n// const sockets_arr = [];\r\n\r\n// wss.on(\"connection\", (socket) => {\r\n//     sockets_arr.push(socket);\r\n//     socket[\"nickname\"] = \"Anonymous\";\r\n//     console.log(\"Connected to Browser ✅\");\r\n//     socket.on(\"close\", onSocketClose);\r\n//     socket.on(\"message\", (msg) => {\r\n//         const message = JSON.parse(msg); //Json.parse는 string을 object로 바꿔준다\r\n//         switch (message.type) {\r\n//             case \"new_message\":\r\n//                 sockets_arr.forEach((aSocket) => aSocket.send(`${socket.nickname}: ${message.payload}`));\r\n//                 break;\r\n//             case \"nickname\":\r\n//                 socket[\"nickname\"] = message.payload;\r\n//             // console.log(message.payload);\r\n//         }\r\n//         // if (parsed.type === \"new_message\") {\r\n//         //     sockets_arr.forEach((aSocket) => aSocket.send(parsed.payload));\r\n//         // } else if(parsed.type === \"nickname\") {\r\n//         //     console.log(parsed.payload);\r\n//         // }\r\n//         // sockets_arr.forEach((aSocket) => aSocket.send(message.toString('utf8')));\r\n//     });\r\n// });\r\n\r\nhttpServer.listen(3000, handleListen);\r\n\r\n// {\r\n//     type: \"message\",\r\n//     payload: \"hello everyone!\"\r\n// }\r\n\r\n// {\r\n//     type: \"nickname\",\r\n//     payload: \"min\"\r\n// }"],"mappings":"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","ignoreList":[]}},"mtime":1714843867522}}